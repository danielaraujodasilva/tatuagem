<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Pinçar Cor – Mistura em Gotas</title>

<style>
body {
  background:#111;
  color:#eee;
  font-family: Arial, sans-serif;
  padding:20px;
}

canvas {
  border:1px solid #444;
  cursor: crosshair;
  max-width:100%;
}

.controls {
  margin:15px 0;
}

select, button {
  padding:8px;
  margin-right:5px;
}

.color-box {
  width:40px;
  height:40px;
  border:1px solid #000;
  display:inline-block;
  vertical-align:middle;
}

.preset {
  background:#1b1b1b;
  border:1px solid #333;
  padding:10px;
  margin-top:10px;
}

.preset button {
  float:right;
}

small {
  color:#aaa;
}
</style>
</head>

<body>

<h2>Pinçar cor da imagem</h2>

<input type="file" id="imageLoader" accept="image/*">

<div class="controls">
  Batoque:
  <select id="cupSize">
    <option value="P">P (5ml)</option>
    <option value="M">M (10ml)</option>
    <option value="G">G (15ml)</option>
    <option value="GG">GG (20ml)</option>
  </select>

  <button onclick="clearPresets()">Limpar tudo</button>
</div>

<canvas id="canvas"></canvas>

<h3>Presets</h3>
<div id="presets"></div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const img = new Image();

const presetsDiv = document.getElementById('presets');

const dropsPerMl = 20;

const cupVolumes = {
  P: 5,
  M: 10,
  G: 15,
  GG: 20
};

document.getElementById('imageLoader').addEventListener('change', e => {
  const reader = new FileReader();
  reader.onload = evt => {
    img.onload = () => {
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
    };
    img.src = evt.target.result;
  };
  reader.readAsDataURL(e.target.files[0]);
});

canvas.addEventListener('click', e => {
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left) * canvas.width / rect.width);
  const y = Math.floor((e.clientY - rect.top) * canvas.height / rect.height);

  const pixel = ctx.getImageData(x, y, 1, 1).data;
  createPreset(pixel[0], pixel[1], pixel[2]);
});

function createPreset(r, g, b) {
  const total = r + g + b || 1;

  const rPct = (r / total) * 100;
  const gPct = (g / total) * 100;
  const bPct = (b / total) * 100;

  const size = document.getElementById('cupSize').value;
  const totalDrops = cupVolumes[size] * dropsPerMl;

  const rDrops = Math.round(totalDrops * (rPct / 100));
  const gDrops = Math.round(totalDrops * (gPct / 100));
  const bDrops = Math.round(totalDrops * (bPct / 100));

  const div = document.createElement('div');
  div.className = 'preset';

  div.innerHTML = `
    <button onclick="this.parentElement.remove()">X</button>
    <div class="color-box" style="background: rgb(${r},${g},${b})"></div>
    <strong> RGB(${r}, ${g}, ${b})</strong><br>
    <small>
      R: ${rPct.toFixed(1)}% → ${rDrops} gotas<br>
      G: ${gPct.toFixed(1)}% → ${gDrops} gotas<br>
      B: ${bPct.toFixed(1)}% → ${bDrops} gotas<br>
      Batoque: ${size} (${totalDrops} gotas)
    </small>
  `;

  presetsDiv.prepend(div);
}

function clearPresets() {
  presetsDiv.innerHTML = '';
}
</script>

</body>
</html>
