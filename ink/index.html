<!-- CÓDIGO COMPLETO ATUALIZADO -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InkMix Pro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#111; color:#eee; }
    .color-preview { width:40px; height:40px; border-radius:6px; border:1px solid #333; }
    canvas { cursor: crosshair; max-width:100%; border-radius:8px; }
    .fade-in { animation: fadeIn .3s ease-in; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(5px);} to {opacity:1;} }
  </style>
</head>
<body class="container py-4">

<h1 class="mb-4">InkMix Pro – RGB + Branco + Preto</h1>

<div class="card bg-dark mb-4">
  <div class="card-body">
    <input type="file" id="imageLoader" class="form-control mb-3" accept="image/*" />
    <canvas id="canvas"></canvas>
  </div>
</div>

<div class="card bg-dark">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>Presets</h4>
      <select id="cupSize" class="form-select w-auto">
        <option value="20">P (20 gotas)</option>
        <option value="40">M (40 gotas)</option>
        <option value="80">G (80 gotas)</option>
        <option value="160">GG (160 gotas)</option>
      </select>
    </div>

    <table class="table table-dark table-striped align-middle">
      <thead>
        <tr>
          <th>Cor</th>
          <th>RGB</th>
          <th>Fórmula</th>
          <th>Gotas</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="presetList"></tbody>
    </table>

    <button class="btn btn-danger" onclick="clearPresets()">Limpar tudo</button>
    <button class="btn btn-secondary" onclick="window.print()">Imprimir</button>
  </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const imageLoader = document.getElementById('imageLoader');
const presetList = document.getElementById('presetList');
const cupSize = document.getElementById('cupSize');
let presets = [];

imageLoader.addEventListener('change', e => {
  const img = new Image();
  img.onload = () => {
    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img,0,0);
  }
  img.src = URL.createObjectURL(e.target.files[0]);
});

canvas.addEventListener('click', e => {
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left) * canvas.width / rect.width);
  const y = Math.floor((e.clientY - rect.top) * canvas.height / rect.height);
  const data = ctx.getImageData(x,y,1,1).data;
  addPreset(data[0], data[1], data[2]);
});

function addPreset(r,g,b){
  const mix = rgbToInk(r,g,b);
  presets.push({r,g,b,mix});
  render();
}

function rgbToInk(r,g,b){
  const max = Math.max(r,g,b);
  const min = Math.min(r,g,b);

  let white = min;
  let black = 255 - max;

  let rr = r - white;
  let gg = g - white;
  let bb = b - white;

  const total = rr + gg + bb + white + black;

  return {
    red: rr/total,
    green: gg/total,
    blue: bb/total,
    white: white/total,
    black: black/total
  };
}

function render(){
  presetList.innerHTML='';
  const totalDrops = parseInt(cupSize.value);

  presets.forEach((p,i)=>{
    const drops = {
      red: Math.round(p.mix.red*totalDrops),
      green: Math.round(p.mix.green*totalDrops),
      blue: Math.round(p.mix.blue*totalDrops),
      white: Math.round(p.mix.white*totalDrops),
      black: Math.round(p.mix.black*totalDrops)
    };

    presetList.innerHTML += `
      <tr class="fade-in">
        <td><div class="color-preview" style="background:rgb(${p.r},${p.g},${p.b})"></div></td>
        <td>${p.r}, ${p.g}, ${p.b}</td>
        <td>R ${(p.mix.red*100).toFixed(1)}% · G ${(p.mix.green*100).toFixed(1)}% · B ${(p.mix.blue*100).toFixed(1)}% · W ${(p.mix.white*100).toFixed(1)}% · K ${(p.mix.black*100).toFixed(1)}%</td>
        <td>R ${drops.red} · G ${drops.green} · B ${drops.blue} · W ${drops.white} · K ${drops.black}</td>
        <td><button class="btn btn-sm btn-outline-danger" onclick="removePreset(${i})">✕</button></td>
      </tr>`;
  });
}

function removePreset(i){ presets.splice(i,1); render(); }
function clearPresets(){ presets=[]; render(); }
</script>
</body>
</html>
 