<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Anamnese - Estúdio de Tatuagem</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .accordion-button {
            font-weight: bold;
        }
        #signatureCanvas {
            border: 1px solid #ced4da;
            background-color: #fff;
            cursor: crosshair;
            touch-action: none;
            width: 100%;
            height: 200px;
        }
        #jsonOutput {
            margin-top: 20px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <h1 class="text-center mb-4">Ficha de Anamnese para Tatuagem</h1>
        <form id="anamneseForm">
            <button type="button" id="autoFill" class="btn btn-warning mb-3 w-100">Preencher com Dados Fictícios</button>

            <div class="accordion" id="accordionSections">
                <!-- Seção 1: Dados do Cliente -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingDadosCliente">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDadosCliente" aria-expanded="true" aria-controls="collapseDadosCliente">
                            Dados do Cliente
                        </button>
                    </h2>
                    <div id="collapseDadosCliente" class="accordion-collapse collapse show" aria-labelledby="headingDadosCliente" data-bs-parent="#accordionSections">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nome" class="form-label">Nome Completo:</label>
                                    <input type="text" class="form-control" id="nome" name="nome" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="dataNascimento" class="form-label">Data de Nascimento:</label>
                                    <input type="date" class="form-control" id="dataNascimento" name="dataNascimento" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="idade" class="form-label">Idade:</label>
                                    <input type="number" class="form-control" id="idade" name="idade" min="18" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="endereco" class="form-label">Endereço:</label>
                                    <input type="text" class="form-control" id="endereco" name="endereco" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="telefone" class="form-label">Telefone:</label>
                                    <input type="tel" class="form-control" id="telefone" name="telefone" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="email" class="form-label">Email:</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="cpf" class="form-label">CPF:</label>
                                    <input type="text" class="form-control" id="cpf" name="cpf" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="genero" class="form-label">Gênero:</label>
                                    <select class="form-select" id="genero" name="genero" required>
                                        <option value="">Selecione</option>
                                        <option value="masculino">Masculino</option>
                                        <option value="feminino">Feminino</option>
                                        <option value="naoBinario">Não Binário</option>
                                        <option value="outro">Outro</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Seção 2: Dados do Agendamento -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingDadosAgendamento">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDadosAgendamento" aria-expanded="false" aria-controls="collapseDadosAgendamento">
                            Dados do Agendamento
                        </button>
                    </h2>
                    <div id="collapseDadosAgendamento" class="accordion-collapse collapse" aria-labelledby="headingDadosAgendamento" data-bs-parent="#accordionSections">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="dataAgendamento" class="form-label">Data do Agendamento:</label>
                                    <input type="date" class="form-control" id="dataAgendamento" name="dataAgendamento" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="horaAgendamento" class="form-label">Hora do Agendamento:</label>
                                    <input type="time" class="form-control" id="horaAgendamento" name="horaAgendamento" required>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="tatuador" class="form-label">Nome do Tatuador:</label>
                                <input type="text" class="form-control" id="tatuador" name="tatuador" required>
                            </div>
                            <div class="mb-3">
                                <label for="descricaoTatuagem" class="form-label">Descrição da Tatuagem:</label>
                                <textarea class="form-control" id="descricaoTatuagem" name="descricaoTatuagem" rows="4" required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="localizacaoCorpo" class="form-label">Localização no Corpo:</label>
                                <input type="text" class="form-control" id="localizacaoCorpo" name="localizacaoCorpo" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Estilo da Tatuagem:</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="pretoBranco" name="estiloCor" value="pretoBranco" checked>
                                    <label class="form-check-label" for="pretoBranco">Preto e Branco</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="colorido" name="estiloCor" value="colorido">
                                    <label class="form-check-label" for="colorido">Colorido</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="imagensTatuagem" class="form-label">Anexar Imagem(ns) da Tatuagem:</label>
                                <input type="file" class="form-control" id="imagensTatuagem" name="imagensTatuagem" multiple accept="image/*">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Seção 3: Histórico Médico -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingHistoricoMedico">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHistoricoMedico" aria-expanded="false" aria-controls="collapseHistoricoMedico">
                            Histórico Médico
                        </button>
                    </h2>
                    <div id="collapseHistoricoMedico" class="accordion-collapse collapse" aria-labelledby="headingHistoricoMedico" data-bs-parent="#accordionSections">
                        <div class="accordion-body">
                            <div class="mb-3">
                                <label class="form-label">Possui alguma condição médica? (Marque as que se aplicam)</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="diabetes" name="condicoes[]" value="diabetes">
                                    <label class="form-check-label" for="diabetes">Diabetes</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="hipertensao" name="condicoes[]" value="hipertensao">
                                    <label class="form-check-label" for="hipertensao">Hipertensão</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="problemasCardiacos" name="condicoes[]" value="problemasCardiacos">
                                    <label class="form-check-label" for="problemasCardiacos">Problemas Cardíacos</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="problemasRenais" name="condicoes[]" value="problemasRenais">
                                    <label class="form-check-label" for="problemasRenais">Problemas Renais</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="epilepsia" name="condicoes[]" value="epilepsia">
                                    <label class="form-check-label" for="epilepsia">Epilepsia</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="hepatite" name="condicoes[]" value="hepatite">
                                    <label class="form-check-label" for="hepatite">Hepatite</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="hiv" name="condicoes[]" value="hiv">
                                    <label class="form-check-label" for="hiv">HIV/AIDS</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="cancer" name="condicoes[]" value="cancer">
                                    <label class="form-check-label" for="cancer">Câncer</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="outrasCondicoes" name="condicoes[]" value="outras">
                                    <label class="form-check-label" for="outrasCondicoes">Outras (especifique abaixo)</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="outrasCondicoesDetalhes" class="form-label">Detalhes de Outras Condições:</label>
                                <textarea class="form-control" id="outrasCondicoesDetalhes" name="outrasCondicoesDetalhes" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="medicamentos" class="form-label">Medicamentos em Uso:</label>
                                <textarea class="form-control" id="medicamentos" name="medicamentos" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="alergias" class="form-label">Alergias (incluindo látex, metais, tintas, etc.):</label>
                                <textarea class="form-control" id="alergias" name="alergias" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Histórico de Pele:</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="psoriase" name="pele[]" value="psoriase">
                                    <label class="form-check-label" for="psoriase">Psoríase</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="eczema" name="pele[]" value="eczema">
                                    <label class="form-check-label" for="eczema">Eczema</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="queloides" name="pele[]" value="queloides">
                                    <label class="form-check-label" for="queloides">Tendência a Queloides</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="cicatrizacaoLenta" name="pele[]" value="cicatrizacaoLenta">
                                    <label class="form-check-label" for="cicatrizacaoLenta">Cicatrizacao Lenta</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="outrasPele" name="pele[]" value="outras">
                                    <label class="form-check-label" for="outrasPele">Outras (especifique abaixo)</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="outrasPeleDetalhes" class="form-label">Detalhes de Outras Condições de Pele:</label>
                                <textarea class="form-control" id="outrasPeleDetalhes" name="outrasPeleDetalhes" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Você fuma?</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="fumaSim" name="fuma" value="sim">
                                    <label class="form-check-label" for="fumaSim">Sim</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="fumaNao" name="fuma" value="nao" checked>
                                    <label class="form-check-label" for="fumaNao">Não</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Você consome álcool regularmente?</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="alcoolSim" name="alcool" value="sim">
                                    <label class="form-check-label" for="alcoolSim">Sim</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="alcoolNao" name="alcool" value="nao" checked>
                                    <label class="form-check-label" for="alcoolNao">Não</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Você está grávida ou amamentando? (Se aplicável)</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="gravidaSim" name="gravida" value="sim">
                                    <label class="form-check-label" for="gravidaSim">Sim</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="gravidaNao" name="gravida" value="nao">
                                    <label class="form-check-label" for="gravidaNao">Não</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="gravidaNaoAplica" name="gravida" value="naoAplica" checked>
                                    <label class="form-check-label" for="gravidaNaoAplica">Não se aplica</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Você fez alguma cirurgia recente? (Últimos 6 meses)</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="cirurgiaSim" name="cirurgia" value="sim">
                                    <label class="form-check-label" for="cirurgiaSim">Sim</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="cirurgiaNao" name="cirurgia" value="nao" checked>
                                    <label class="form-check-label" for="cirurgiaNao">Não</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="cirurgiaDetalhes" class="form-label">Detalhes da Cirurgia:</label>
                                <textarea class="form-control" id="cirurgiaDetalhes" name="cirurgiaDetalhes" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Você tem tatuagens anteriores?</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="tatuagensAnterioresSim" name="tatuagensAnteriores" value="sim">
                                    <label class="form-check-label" for="tatuagensAnterioresSim">Sim</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="tatuagensAnterioresNao" name="tatuagensAnteriores" value="nao" checked>
                                    <label class="form-check-label" for="tatuagensAnterioresNao">Não</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="tatuagensAnterioresDetalhes" class="form-label">Detalhes (reações, infecções, etc.):</label>
                                <textarea class="form-control" id="tatuagensAnterioresDetalhes" name="tatuagensAnterioresDetalhes" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Seção 4: Consentimento e Termos -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingConsentimento">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseConsentimento" aria-expanded="false" aria-controls="collapseConsentimento">
                            Consentimento e Termos
                        </button>
                    </h2>
                    <div id="collapseConsentimento" class="accordion-collapse collapse" aria-labelledby="headingConsentimento" data-bs-parent="#accordionSections">
                        <div class="accordion-body">
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="consentimentoInformado" name="consentimento[]" value="informado" required>
                                    <label class="form-check-label" for="consentimentoInformado">Declaro que fui informado sobre os riscos da tatuagem, incluindo infecções, reações alérgicas e cicatrização.</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="consentimentoCuidados" name="consentimento[]" value="cuidados" required>
                                    <label class="form-check-label" for="consentimentoCuidados">Comprometo-me a seguir as instruções de cuidados pós-tatuagem.</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="consentimentoMaioridade" name="consentimento[]" value="maioridade" required>
                                    <label class="form-check-label" for="consentimentoMaioridade">Declaro ser maior de 18 anos ou ter autorização legal.</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="consentimentoDados" name="consentimento[]" value="dados" required>
                                    <label class="form-check-label" for="consentimentoDados">Autorizo o armazenamento e uso dos meus dados para fins do estúdio.</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Assinatura Digital:</label>
                                <canvas id="signatureCanvas"></canvas>
                                <button type="button" id="clearSignature" class="btn btn-danger btn-sm mt-2">Limpar Assinatura</button>
                            </div>
                            <div class="mb-3">
                                <label for="dataAssinatura" class="form-label">Data:</label>
                                <input type="date" class="form-control" id="dataAssinatura" name="dataAssinatura" required>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-success mt-3 w-100">Enviar e Baixar JSON Atualizado</button>
        </form>

        <div id="jsonOutput" class="alert alert-info mt-3" role="alert"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        const form = document.getElementById('anamneseForm');
        const jsonOutput = document.getElementById('jsonOutput');
        const canvas = document.getElementById('signatureCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;
        let lastX = 0;
        let lastY = 0;

        // Ajustar tamanho do canvas
        function resizeCanvas() {
            canvas.width = canvas.clientWidth;
            canvas.height = 200;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Funções para desenho
        function startDrawing(e) {
            drawing = true;
            const pos = getPosition(e);
            lastX = pos.x;
            lastY = pos.y;
            drawDot(lastX, lastY); // Desenhar ponto inicial para cliques únicos
            e.preventDefault();
        }

        function draw(e) {
            if (!drawing) return;
            const pos = getPosition(e);
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(pos.x, pos.y);
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000';
            ctx.stroke();
            lastX = pos.x;
            lastY = pos.y;
            e.preventDefault();
        }

        function stopDrawing(e) {
            drawing = false;
            e.preventDefault();
        }

        function getPosition(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            let x, y;
            if (e.type.includes('touch')) {
                x = (e.touches[0].clientX - rect.left) * scaleX;
                y = (e.touches[0].clientY - rect.top) * scaleY;
            } else {
                x = (e.clientX - rect.left) * scaleX;
                y = (e.clientY - rect.top) * scaleY;
            }
            return { x, y };
        }

        function drawDot(x, y) {
            ctx.beginPath();
            ctx.arc(x, y, 1, 0, 2 * Math.PI);
            ctx.fillStyle = '#000';
            ctx.fill();
        }

        // Eventos
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);

        document.getElementById('clearSignature').addEventListener('click', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        // Preenchimento automático
        document.getElementById('autoFill').addEventListener('click', function() {
            document.getElementById('nome').value = 'João Silva';
            document.getElementById('dataNascimento').value = '1990-05-15';
            document.getElementById('idade').value = 35;
            document.getElementById('endereco').value = 'Rua Exemplo, 123, São Paulo, SP';
            document.getElementById('telefone').value = '(11) 99999-9999';
            document.getElementById('email').value = 'joao.silva@example.com';
            document.getElementById('cpf').value = '123.456.789-00';
            document.getElementById('genero').value = 'masculino';

            document.getElementById('dataAgendamento').value = '2026-01-11';
            document.getElementById('horaAgendamento').value = '14:00';
            document.getElementById('tatuador').value = 'Artista Exemplo';
            document.getElementById('descricaoTatuagem').value = 'Uma tatuagem de dragão no braço.';
            document.getElementById('localizacaoCorpo').value = 'Braço direito';

            document.getElementById('hipertensao').checked = true;
            document.getElementById('outrasCondicoesDetalhes').value = 'Nenhuma outra.';
            document.getElementById('medicamentos').value = 'Nenhum.';
            document.getElementById('alergias').value = 'Alergia a látex.';
            document.getElementById('queloides').checked = true;
            document.getElementById('fumaNao').checked = true;
            document.getElementById('alcoolNao').checked = true;
            document.getElementById('gravidaNaoAplica').checked = true;
            document.getElementById('cirurgiaNao').checked = true;
            document.getElementById('tatuagensAnterioresSim').checked = true;
            document.getElementById('tatuagensAnterioresDetalhes').value = 'Uma tatuagem anterior sem problemas.';

            document.getElementById('consentimentoInformado').checked = true;
            document.getElementById('consentimentoCuidados').checked = true;
            document.getElementById('consentimentoMaioridade').checked = true;
            document.getElementById('consentimentoDados').checked = true;
            document.getElementById('dataAssinatura').value = '2026-01-11';

            // Simular assinatura
            ctx.beginPath();
            ctx.moveTo(50, 100);
            ctx.lineTo(350, 100);
            ctx.stroke();
        });

        // Submissão do formulário
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(form);
            const data = {};
            const files = document.getElementById('imagensTatuagem').files;
            data.imagensPaths = [];

            // Processar imagens como caminhos simulados
            for (let file of files) {
                data.imagensPaths.push(`tatuagens/${file.name}`);
            }

            // Processar campos simples
            for (let [key, value] of formData.entries()) {
                if (key.endsWith('[]')) {
                    key = key.slice(0, -2);
                    if (!data[key]) data[key] = [];
                    data[key].push(value);
                } else if (key !== 'imagensTatuagem') {
                    data[key] = value;
                }
            }

            // Adicionar assinatura como caminho simulado
            const assinaturaNomeArquivo = data.nome ? `${data.nome.replace(/\s/g, '_')}.png` : 'assinatura.png';
            data.assinaturaPath = `assinaturas/${assinaturaNomeArquivo}`;

            // Nota: Em um ambiente com servidor, aqui enviaria as imagens e assinatura para salvar nas pastas

            // Carregar dados existentes do localStorage
            let clientes = JSON.parse(localStorage.getItem('anamneseClientes')) || [];
            clientes.push(data);
            localStorage.setItem('anamneseClientes', JSON.stringify(clientes));

            // Baixar o JSON atualizado
            const jsonString = JSON.stringify(clientes, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'anamnese.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Exibir mensagem
            jsonOutput.textContent = 'JSON atualizado baixado com sucesso! (anamnese.json)';
            console.log(clientes); // Para depuração
        });
    </script>
</body>
</html>