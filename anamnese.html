<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Anamnese - Estúdio de Tatuagem</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        form {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        section {
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 20px;
        }
        h2 {
            color: #555;
            margin-bottom: 10px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="email"], input[type="tel"], input[type="date"], input[type="time"], input[type="number"], select, textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        input[type="checkbox"], input[type="radio"] {
            margin-right: 5px;
        }
        .checkbox-group {
            margin-bottom: 10px;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #218838;
        }
        #autoFill {
            background-color: #007bff;
        }
        #autoFill:hover {
            background-color: #0069d9;
        }
        #clearSignature {
            background-color: #dc3545;
            width: auto;
            display: inline-block;
        }
        #clearSignature:hover {
            background-color: #c82333;
        }
        #signatureCanvas {
            border: 1px solid #000;
            cursor: crosshair;
            touch-action: none;
        }
        #jsonOutput {
            margin-top: 20px;
            padding: 10px;
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 4px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>Ficha de Anamnese para Tatuagem</h1>
    <form id="anamneseForm">
        <!-- Botão de Preenchimento Automático -->
        <button type="button" id="autoFill">Preencher com Dados Fictícios</button>

        <!-- Seção 1: Dados do Cliente -->
        <section id="dadosCliente">
            <h2>Dados do Cliente</h2>
            <label for="nome">Nome Completo:</label>
            <input type="text" id="nome" name="nome" required>

            <label for="dataNascimento">Data de Nascimento:</label>
            <input type="date" id="dataNascimento" name="dataNascimento" required>

            <label for="idade">Idade:</label>
            <input type="number" id="idade" name="idade" min="18" required>

            <label for="endereco">Endereço:</label>
            <input type="text" id="endereco" name="endereco" required>

            <label for="telefone">Telefone:</label>
            <input type="tel" id="telefone" name="telefone" required>

            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>

            <label for="cpf">CPF:</label>
            <input type="text" id="cpf" name="cpf" required>

            <label for="genero">Gênero:</label>
            <select id="genero" name="genero" required>
                <option value="">Selecione</option>
                <option value="masculino">Masculino</option>
                <option value="feminino">Feminino</option>
                <option value="naoBinario">Não Binário</option>
                <option value="outro">Outro</option>
            </select>
        </section>

        <!-- Seção 2: Dados do Agendamento -->
        <section id="dadosAgendamento">
            <h2>Dados do Agendamento</h2>
            <label for="dataAgendamento">Data do Agendamento:</label>
            <input type="date" id="dataAgendamento" name="dataAgendamento" required>

            <label for="horaAgendamento">Hora do Agendamento:</label>
            <input type="time" id="horaAgendamento" name="horaAgendamento" required>

            <label for="tatuador">Nome do Tatuador:</label>
            <input type="text" id="tatuador" name="tatuador" required>

            <label for="descricaoTatuagem">Descrição da Tatuagem:</label>
            <textarea id="descricaoTatuagem" name="descricaoTatuagem" rows="4" required></textarea>

            <label for="localizacaoCorpo">Localização no Corpo:</label>
            <input type="text" id="localizacaoCorpo" name="localizacaoCorpo" required>

            <label>Estilo da Tatuagem:</label>
            <input type="radio" id="pretoBranco" name="estiloCor" value="pretoBranco" checked><label for="pretoBranco">Preto e Branco</label>
            <input type="radio" id="colorido" name="estiloCor" value="colorido"><label for="colorido">Colorido</label><br>

            <label for="imagensTatuagem">Anexar Imagem(ns) da Tatuagem:</label>
            <input type="file" id="imagensTatuagem" name="imagensTatuagem" multiple accept="image/*">
        </section>

        <!-- Seção 3: Histórico Médico -->
        <section id="historicoMedico">
            <h2>Histórico Médico</h2>
            <div class="checkbox-group">
                <label>Possui alguma condição médica? (Marque as que se aplicam)</label>
                <input type="checkbox" id="diabetes" name="condicoes[]" value="diabetes"><label for="diabetes">Diabetes</label><br>
                <input type="checkbox" id="hipertensao" name="condicoes[]" value="hipertensao"><label for="hipertensao">Hipertensão</label><br>
                <input type="checkbox" id="problemasCardiacos" name="condicoes[]" value="problemasCardiacos"><label for="problemasCardiacos">Problemas Cardíacos</label><br>
                <input type="checkbox" id="problemasRenais" name="condicoes[]" value="problemasRenais"><label for="problemasRenais">Problemas Renais</label><br>
                <input type="checkbox" id="epilepsia" name="condicoes[]" value="epilepsia"><label for="epilepsia">Epilepsia</label><br>
                <input type="checkbox" id="hepatite" name="condicoes[]" value="hepatite"><label for="hepatite">Hepatite</label><br>
                <input type="checkbox" id="hiv" name="condicoes[]" value="hiv"><label for="hiv">HIV/AIDS</label><br>
                <input type="checkbox" id="cancer" name="condicoes[]" value="cancer"><label for="cancer">Câncer</label><br>
                <input type="checkbox" id="outrasCondicoes" name="condicoes[]" value="outras"><label for="outrasCondicoes">Outras (especifique abaixo)</label>
            </div>
            <label for="outrasCondicoesDetalhes">Detalhes de Outras Condições:</label>
            <textarea id="outrasCondicoesDetalhes" name="outrasCondicoesDetalhes" rows="3"></textarea>

            <label for="medicamentos">Medicamentos em Uso:</label>
            <textarea id="medicamentos" name="medicamentos" rows="3"></textarea>

            <label for="alergias">Alergias (incluindo látex, metais, tintas, etc.):</label>
            <textarea id="alergias" name="alergias" rows="3"></textarea>

            <div class="checkbox-group">
                <label>Histórico de Pele:</label>
                <input type="checkbox" id="psoriase" name="pele[]" value="psoriase"><label for="psoriase">Psoríase</label><br>
                <input type="checkbox" id="eczema" name="pele[]" value="eczema"><label for="eczema">Eczema</label><br>
                <input type="checkbox" id="queloides" name="pele[]" value="queloides"><label for="queloides">Tendência a Queloides</label><br>
                <input type="checkbox" id="cicatrizacaoLenta" name="pele[]" value="cicatrizacaoLenta"><label for="cicatrizacaoLenta">Cicatrizacao Lenta</label><br>
                <input type="checkbox" id="outrasPele" name="pele[]" value="outras"><label for="outrasPele">Outras (especifique abaixo)</label>
            </div>
            <label for="outrasPeleDetalhes">Detalhes de Outras Condições de Pele:</label>
            <textarea id="outrasPeleDetalhes" name="outrasPeleDetalhes" rows="3"></textarea>

            <label>Você fuma?</label>
            <input type="radio" id="fumaSim" name="fuma" value="sim"><label for="fumaSim">Sim</label>
            <input type="radio" id="fumaNao" name="fuma" value="nao" checked><label for="fumaNao">Não</label><br>

            <label>Você consome álcool regularmente?</label>
            <input type="radio" id="alcoolSim" name="alcool" value="sim"><label for="alcoolSim">Sim</label>
            <input type="radio" id="alcoolNao" name="alcool" value="nao" checked><label for="alcoolNao">Não</label><br>

            <label>Você está grávida ou amamentando? (Se aplicável)</label>
            <input type="radio" id="gravidaSim" name="gravida" value="sim"><label for="gravidaSim">Sim</label>
            <input type="radio" id="gravidaNao" name="gravida" value="nao"><label for="gravidaNao">Não</label>
            <input type="radio" id="gravidaNaoAplica" name="gravida" value="naoAplica" checked><label for="gravidaNaoAplica">Não se aplica</label><br>

            <label>Você fez alguma cirurgia recente? (Últimos 6 meses)</label>
            <input type="radio" id="cirurgiaSim" name="cirurgia" value="sim"><label for="cirurgiaSim">Sim</label>
            <input type="radio" id="cirurgiaNao" name="cirurgia" value="nao" checked><label for="cirurgiaNao">Não</label><br>
            <label for="cirurgiaDetalhes">Detalhes da Cirurgia:</label>
            <textarea id="cirurgiaDetalhes" name="cirurgiaDetalhes" rows="3"></textarea>

            <label>Você tem tatuagens anteriores?</label>
            <input type="radio" id="tatuagensAnterioresSim" name="tatuagensAnteriores" value="sim"><label for="tatuagensAnterioresSim">Sim</label>
            <input type="radio" id="tatuagensAnterioresNao" name="tatuagensAnteriores" value="nao" checked><label for="tatuagensAnterioresNao">Não</label><br>
            <label for="tatuagensAnterioresDetalhes">Detalhes (reações, infecções, etc.):</label>
            <textarea id="tatuagensAnterioresDetalhes" name="tatuagensAnterioresDetalhes" rows="3"></textarea>
        </section>

        <!-- Seção 4: Consentimento e Termos -->
        <section id="consentimento">
            <h2>Consentimento e Termos</h2>
            <div class="checkbox-group">
                <input type="checkbox" id="consentimentoInformado" name="consentimento[]" value="informado" required><label for="consentimentoInformado">Declaro que fui informado sobre os riscos da tatuagem, incluindo infecções, reações alérgicas e cicatrização.</label><br>
                <input type="checkbox" id="consentimentoCuidados" name="consentimento[]" value="cuidados" required><label for="consentimentoCuidados">Comprometo-me a seguir as instruções de cuidados pós-tatuagem.</label><br>
                <input type="checkbox" id="consentimentoMaioridade" name="consentimento[]" value="maioridade" required><label for="consentimentoMaioridade">Declaro ser maior de 18 anos ou ter autorização legal.</label><br>
                <input type="checkbox" id="consentimentoDados" name="consentimento[]" value="dados" required><label for="consentimentoDados">Autorizo o armazenamento e uso dos meus dados para fins do estúdio.</label>
            </div>
            <label>Assinatura Digital:</label>
            <canvas id="signatureCanvas" width="400" height="200"></canvas><br>
            <button type="button" id="clearSignature">Limpar Assinatura</button>

            <label for="dataAssinatura">Data:</label>
            <input type="date" id="dataAssinatura" name="dataAssinatura" required>
        </section>

        <button type="submit">Enviar e Gerar JSON</button>
    </form>

    <div id="jsonOutput"></div>

    <script>
        const form = document.getElementById('anamneseForm');
        const jsonOutput = document.getElementById('jsonOutput');
        const canvas = document.getElementById('signatureCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        // Funções para desenho na canvas
        canvas.addEventListener('mousedown', () => { drawing = true; });
        canvas.addEventListener('mouseup', () => { drawing = false; ctx.beginPath(); });
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('touchstart', (e) => { drawing = true; getTouchPos(e); });
        canvas.addEventListener('touchend', () => { drawing = false; ctx.beginPath(); });
        canvas.addEventListener('touchmove', (e) => { if (drawing) draw(getTouchPos(e)); });

        function draw(e) {
            if (!drawing) return;
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000';
            ctx.lineTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(e.clientX - canvas.offsetLeft, e.clientY - canvas.offsetTop);
        }

        function getTouchPos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                clientX: e.touches[0].clientX - rect.left,
                clientY: e.touches[0].clientY - rect.top
            };
        }

        document.getElementById('clearSignature').addEventListener('click', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        // Preenchimento automático com dados fictícios
        document.getElementById('autoFill').addEventListener('click', function() {
            document.getElementById('nome').value = 'João Silva';
            document.getElementById('dataNascimento').value = '1990-05-15';
            document.getElementById('idade').value = 35;
            document.getElementById('endereco').value = 'Rua Exemplo, 123, São Paulo, SP';
            document.getElementById('telefone').value = '(11) 99999-9999';
            document.getElementById('email').value = 'joao.silva@example.com';
            document.getElementById('cpf').value = '123.456.789-00';
            document.getElementById('genero').value = 'masculino';

            document.getElementById('dataAgendamento').value = '2026-01-11';
            document.getElementById('horaAgendamento').value = '14:00';
            document.getElementById('tatuador').value = 'Artista Exemplo';
            document.getElementById('descricaoTatuagem').value = 'Uma tatuagem de dragão no braço.';
            document.getElementById('localizacaoCorpo').value = 'Braço direito';
            // Estilo cor default já é preto e branco

            // Histórico Médico fictício
            document.getElementById('diabetes').checked = false;
            document.getElementById('hipertensao').checked = true;
            document.getElementById('outrasCondicoesDetalhes').value = 'Nenhuma outra.';
            document.getElementById('medicamentos').value = 'Nenhum.';
            document.getElementById('alergias').value = 'Alergia a látex.';
            document.getElementById('psoriase').checked = false;
            document.getElementById('queloides').checked = true;
            document.getElementById('outrasPeleDetalhes').value = '';
            document.getElementById('fumaNao').checked = true;
            document.getElementById('alcoolNao').checked = true;
            document.getElementById('gravidaNaoAplica').checked = true;
            document.getElementById('cirurgiaNao').checked = true;
            document.getElementById('cirurgiaDetalhes').value = '';
            document.getElementById('tatuagensAnterioresSim').checked = true;
            document.getElementById('tatuagensAnterioresDetalhes').value = 'Uma tatuagem anterior sem problemas.';

            // Consentimento
            document.getElementById('consentimentoInformado').checked = true;
            document.getElementById('consentimentoCuidados').checked = true;
            document.getElementById('consentimentoMaioridade').checked = true;
            document.getElementById('consentimentoDados').checked = true;
            document.getElementById('dataAssinatura').value = '2026-01-11';

            // Simular assinatura (desenho simples)
            ctx.beginPath();
            ctx.moveTo(50, 100);
            ctx.lineTo(350, 100);
            ctx.stroke();
        });

        // Submissão do formulário
        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            const formData = new FormData(form);
            const data = {};
            const files = document.getElementById('imagensTatuagem').files;
            data.imagensBase64 = [];

            // Processar imagens para base64
            for (let file of files) {
                const base64 = await readFileAsBase64(file);
                data.imagensBase64.push({
                    nome: file.name,
                    base64: base64
                });
            }

            // Processar campos simples
            for (let [key, value] of formData.entries()) {
                if (key.endsWith('[]')) {
                    key = key.slice(0, -2);
                    if (!data[key]) data[key] = [];
                    data[key].push(value);
                } else if (key !== 'imagensTatuagem') { // Ignorar o campo de files
                    data[key] = value;
                }
            }

            // Adicionar assinatura como base64
            const assinaturaBase64 = canvas.toDataURL('image/png');
            data.assinaturaBase64 = assinaturaBase64;
            data.assinaturaNomeArquivo = data.nome ? `${data.nome.replace(/\s/g, '_')}.png` : 'assinatura.png';

            // Exibir JSON
            jsonOutput.textContent = JSON.stringify(data, null, 2);
            console.log(data); // Para depuração ou integração futura com BD

            // Aqui, em um ambiente com servidor, você poderia enviar o JSON para salvar as imagens e assinatura em pastas como 'img' e 'assinaturas'
        });

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>